---
title: "Load-cell calibration --- tidying the data"
author: "Richard Layton"
date: '2016-08-24'
output: html_document
---

```{r, setup, include = FALSE}
library(knitr)
opts_knit$set(root.dir = '../')
opts_chunk$set(echo = TRUE)
```

# Add a column of observation numbers

```{r}
# read the long-form data file we saved in the previous step 
library(readr)
tidy_data <- read_csv('data/01_calibr_long-data.csv')
```

The test points are in the order in which the data were acquired (consistent with the ANSI/ISA standard). So the observation number is the same as the row number. 

```{r}
library(dplyr)
# observation numbers are a sequence of integers, from 1 to the number of rows
nrow_in_tidy_data <- nrow(tidy_data)
tidy_data <- tidy_data %>%
	mutate(observ = 1:nrow_in_tidy_data)
head(tidy_data)
```

# simplify the cycle number

The *cycle* data are strings, *cycle_1*, *cycle_2*, etc., from the column headings in the original data set. It might be useful omit the word "cycle" altogether and replace the data with an integer number for the cycle. 

First, I separate the *cycle* column into two parts using the underscore in the data as the separation pattern. 

```{r}
library(tidyr)
tidy_data  <- tidy_data %>%
	separate(cycle, into = c('prefix', 'cycle'), sep = '_')
```

Examine the separated columns.

```{r}
head(tidy_data)
```

I can delete the new prefix column and I'll convert the cycle column from a character to an integer. 

```{r}
tidy_data <- tidy_data %>%
	select(-prefix) %>%
	mutate(cycle = as.integer(cycle))
```

```{r}
# Examine the results
head(tidy_data)
tail(tidy_data)
```

Spot checking with *head()* and *tail()*, I confirm that the new cycle column is as expected. 

# Final touches 

The last steps in tidying this data set are to shorten the *test_point* column name and to rearrange columns in a logical order. 

```{r}
tidy_data <- tidy_data %>%
	select(observ, cycle, test_pt = test_point, input_lb, output_mV)
print(tidy_data)
```

Write the tidy data to file in the data directory.

```{r}
write_csv(tidy_data, "data/02_calibr_tidy-data.csv")
```

    
    

