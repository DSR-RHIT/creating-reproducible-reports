---
title: 'Load cell calibration report'
subtitle: 'Illustrating common tasks in reproducible reporting'
author: 'Richard Layton'
date: '2016-08-24'
output:
  word_document:
    reference_docx: 'template-01.docx'
    pandoc_args: [
      "--smart"
    ]
bibliography: 'calibration.bib' 
csl: 'csl-files/wiley-vch-books.csl'
---




```{r include = FALSE}
library(knitr)
opts_knit$set(root.dir = '../')
opts_chunk$set(echo = FALSE, include = FALSE, message = FALSE, fig.width = 3, fig.asp = 1)
options(digits = 2)
```

# Introduction

Calibrating a _load cell_ (a sensor for measuring uniaxial force) yields two main results: a calibration equation relating output voltage (mV) to input force (lb); and an estimate of sensor accuracy as a percentage of full span. In this report, I present the test results for an Omega LCL-005 load cell calibrated following the ANSI/ISA procedure [@ansi1993].

![Figure 1. Omega LCL005 load cell (replace stock photo with image of our setup)](omega-load-cell.jpg)

```{r}
library(readr)
df  <- read_csv('print-pages/calibration-data.csv')
df2 <- read_csv('print-pages/calibration-table.csv')
```

The data, shown in Table 1, has `r max(df$observ)` observations over `r max(df$cycle)` up-down cycles. Per the ANSI/ISA standard, the test begins and ends at a midspan test point in the same direction, thus the first and last cycle are incomplete (indicated by NA).

```{r include = TRUE, results = 'asis'}
kable(df2, caption = 'Table 1: Calibration data')
```

# Analysis

```{r}
# perform the regression
regr_results <- lm(output_mV ~ input_lb, data = df)

# extract the y-fitted values andf compute span
y_fit    <- regr_results$fitted.values
span_max <- max(y_fit)
span_min <- min(y_fit)
span     <- span_max - span_min

# summarize the regression results and extract specific values
regr_summ <- summary.lm(regr_results)
residuals <- regr_summ$residuals
intercept <- regr_summ$coefficients[1]
slope     <- regr_summ$coefficients[2]
adj_r_sq  <- regr_summ$adj.r.squared

# create a character variable for pretty plus/minus in equation
intercept_sign <- if(intercept >= 0){'+'}else{'-'}

# extract accuracy max/min from the residuals
accuracy_plus  <- max(residuals)
accuracy_minus <- min(residuals)

# accuracy as percent of span
accuracy_plus_pct  <- accuracy_plus / span * 100
accuracy_minus_pct <- abs(accuracy_minus / span * 100)
accuracy_pm_pct    <- max(abs(c(accuracy_plus_pct, accuracy_minus_pct)))

# create a data frame for printing a table of results
Result <- c('slope', 'intercept', 'adjusted $R^2$', 'max residual', 'min residual')
Value  <- c(slope, intercept, adj_r_sq, accuracy_plus, accuracy_minus)
Units  <- c('mV/lb', 'mV', 'mV', 'mV', 'mV')
tabulated_results <- data.frame(Result, Value, Units)
```

_Calibration curve._ The independent variable in this calibration is the sensor input (force) and the dependent variable is the sensor output (voltage readings). Performing a linear regression yields the results summarized in Table 2.

```{r include = TRUE, results = 'asis'}
kable(tabulated_results
      , caption = 'Table 2: Regression results'
      )
```

The calibration equation, in terms of force $F$ (lb) and sensor readout $R$ (mV), is given by
$$
R = `r slope`  \ F  `r intercept_sign` `r abs(intercept)`
$$
and the calibration curve is shown in Figure 2. The data markers in the graph have been jittered to reduce overprinting, but the regression line is based on non-jittered values.

```{r include = TRUE, fig.cap = 'Figure 2: Calibration curve.'}
# select the x y data from the data frame
x = df$input_lb
y = df$output_mV

# set some graph paramaters
par(cex = 0.7, mar = c(4, 4, 1, 1))

# graph the data
plot(jitter(x, 0.5), jitter(y, 0.5)
     , xlab = 'Force (lb)'
     , ylab = 'Readout (mV)'
     , pch = 1
     , cex = 0.9
     )

# add the regression curve
lines(y_fit ~ x
      , col = 'gray60'
      , lwd = 0.5
      )
```

_Accuracy._ Accuracy is defined as the largest positive and negative residuals. Thus, from Table 2, the accuracy bounds are $`r accuracy_plus`$ mV and $`r accuracy_minus`$ mV. The residuals are plotted in Figure 3 with the upper and lower bounds indicated with dashed lines.

```{r include = TRUE, fig.cap = 'Figure 3: Residuals from the linear regression'}
# set some graph paramaters
par(cex = 0.7, mar = c(4, 4, 1, 1))

# graph the data
plot(residuals ~ x
     , xlab = 'Test point (lb)'
     , ylab = 'Residuals (mV)'
     , pch = 16
     )

# add ref line at y = 0
abline(h = 0
       , lwd = 0.5
       , col = 'gray60'
       )

# add ref lines at max and min bounds
abline(h = c(accuracy_plus, accuracy_minus)
       , lwd = 0.5
       , lty = 2
       , col = 'gray60'
       )

```

As a percentage of span, sensor accuracy is $+ `r accuracy_plus_pct`$ and  $- `r accuracy_minus_pct`$ %. Many users prefer a single value to estimate systematic uncertainty in a measurement, so we take the more conservative of the two numbers and report

> load cell accuracy $=\pm `r accuracy_pm_pct` \%$ of reading

# References


